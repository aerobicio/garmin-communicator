;(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
(function(){var i,t,n,e=function(i,t){return function(){return i.apply(t,arguments)}},r=[].slice;t=require("../src/plugin").Plugin,n=require("../src/utils/xmlparser").XMLParser,exports.Communicator=i=function(){"use strict";function i(){}var o,s,u;return s=null,u=null,i.get=function(i){return null==i&&(i={}),s||(s=i),u||(u=new o(s))},i.destroy=function(){u=null},o=function(){function i(i){this.devices=e(this.devices,this),this.configuration=i,this.plugin=new t,this.pluginIsInstalled=this.plugin.pluginIsInstalled(),this.pluginProxy=this.plugin.el}return i.prototype.pluginIsInstalled=null,i.prototype.invoke=function(){var i,t,n;if(n=arguments[0],i=2<=arguments.length?r.call(arguments,1):[],t=this.pluginProxy[n],null!=t&&"function"==typeof t)return t.apply(this.pluginProxy,i);throw new Error("'"+n+"' function does not exist!")},i.prototype.write=function(i,t){return this.pluginProxy.hasOwnProperty(i)?this.pluginProxy[i]=t:void 0},i.prototype.read=function(i){return this.pluginProxy.hasOwnProperty(i)?this.pluginProxy[i]:void 0},i.prototype.busy=function(i){return null!=i&&(this._busy=i),this._busy||!1},i.prototype.isLocked=function(){return this.pluginProxy.Locked},i.prototype.unlock=function(i){var t,n=this;return this.isLocked()?(t=!1,_(i).map(function(i,e){return t||(t=n.invoke("Unlock",e,i))}),t):void 0},i.prototype.devices=function(){var i,t=this;return this.busy()?void 0:(this.busy(!0),this.unlock(),i=Q.defer(),i.promise["finally"](function(){return t.busy(!1)}),this._findDevices(i),i.promise)},i.prototype._findDevices=function(i){return this.invoke("StartFindDevices"),this._loopUntilFinishedFindingDevices(i)},i.prototype._loopUntilFinishedFindingDevices=function(i){var t=this;return this.invoke("FinishFindDevices")?i.resolve(this._parseDeviceXml()):setTimeout(function(){return t._loopUntilFinishedFindingDevices(i)},100)},i.prototype._parseDeviceXml=function(){var i,t;return i=require("../src/device").Device,t=n.parse(this.invoke("DevicesXmlString")),_(t.getElementsByTagName("Device")).map(function(t){var n,e;return n=t.getAttribute("DisplayName"),e=parseInt(t.getAttribute("Number"),10),new i(e,n)})},i}(),i}.call(this)}).call(this);
},{"../src/device":2,"../src/plugin":6,"../src/utils/xmlparser":7}],2:[function(require,module,exports){
(function(){var e,t,i,r;e=require("../src/communicator").Communicator,i=require("../src/device/reader").Reader,r=require("../src/utils/xmlparser").XMLParser,exports.Device=t=function(){"use strict";function t(t,i){this.number=t,this.name=i,this.communicator=e.get(),this.deviceDescriptionXml=this._getDeviceDescriptionXml(),this._setDeviceInfo(),this._setDeviceCapabilities(),this._createDeviceAccessors()}return t.prototype.ACTIONS={Activities:["FitnessHistory","FitnessDirectory"],Workouts:["FitnessWorkouts","FitnessData"],Courses:["FitnessCourses","FitnessData"],Goals:["FitnessActivityGoals","FitnessData"],Profile:["FitnessUserProfile","FitnessData"],FITActivities:["FIT_TYPE_4","FITDirectory"]},t.prototype.activities=function(){return this.canReadFITActivities?this.readFITActivities():this.readActivities()},t.prototype._setDeviceCapabilities=function(){return _.each(this.ACTIONS,function(e,t){return this["canRead"+t]=this._canXY("Output",e[0]),this["canWrite"+t]=this._canXY("Input",e[0])},this)},t.prototype._createDeviceAccessors=function(){return _.each(this.ACTIONS,function(e,t){return this["read"+t]=this._reader(t,e[0],e[1]),this["write"+t]=this._writer()},this)},t.prototype._reader=function(e,t,r){return function(){var n;if(!this["canRead"+e])throw new Error("read"+e+" is not supported on this device");return n=new i(this,t,r),n.perform()}},t.prototype._writer=function(){return function(){throw new Error("Not implemented")}},t.prototype._canXY=function(e,t){var i,r,n;return i=null!=(r=this._getDataTypeNodeForDataTypeName(t))?null!=(n=r.getElementsByTagName("File")[0])?n.getElementsByTagName("TransferDirection")[0].textContent:void 0:void 0,null!=i&&new RegExp(e).test(i)},t.prototype._getDataTypeNodeForDataTypeName=function(e){var t;return t=this._getDeviceDataTypesXml(),t?_.filter(t,function(t){return e===t.getElementsByTagName("Name")[0].textContent})[0]:void 0},t.prototype._getDeviceDataTypesXml=function(){var e,t;return this._deviceDataTypes||(this._deviceDataTypes=null!=(e=this.deviceDescriptionXml)?null!=(t=e.getElementsByTagName("MassStorageMode")[0])?t.getElementsByTagName("DataType"):void 0:void 0)},t.prototype._setDeviceInfo=function(){return this.id=this._deviceId(),this.name=this._deviceDisplayName(),this.partNumber=this._devicePartNumber(),this.softwareVersion=this._softwareVersion()},t.prototype._getDeviceDescriptionXml=function(){var e;return e=this.communicator.invoke("DeviceDescription",this.number),r.parse(e)},t.prototype._deviceId=function(){return this.deviceDescriptionXml.getElementsByTagName("Id")[0].textContent},t.prototype._deviceDisplayName=function(){var e;return e=this.deviceDescriptionXml.getElementsByTagName("Model")[0],e.getElementsByTagName("DisplayName").length?e.getElementsByTagName("DisplayName")[0].textContent:e.getElementsByTagName("Description")[0].textContent},t.prototype._devicePartNumber=function(){return this.deviceDescriptionXml.getElementsByTagName("Model")[0].getElementsByTagName("PartNumber")[0].textContent},t.prototype._softwareVersion=function(){return this.deviceDescriptionXml.getElementsByTagName("Model")[0].getElementsByTagName("SoftwareVersion")[0].textContent},t}()}).call(this);
},{"../src/communicator":1,"../src/device/reader":4,"../src/utils/xmlparser":7}],3:[function(require,module,exports){
(function(){var t,e,i,n=function(t,e){return function(){return t.apply(e,arguments)}};e=require("../../src/communicator").Communicator,i=require("../utils/xmlparser").XMLParser,exports.Accessor=t=function(){"use strict";function t(t,i,r){this.device=t,this.dataType=i,this.pluginMethod=r,this._checkFinished=n(this._checkFinished,this),this.communicator=e.get(),this.pluginAction=""+this.ACTION+this.pluginMethod}return t.prototype.PERCENT_REGEX=/^[0-9]+%/,t.prototype.STATUS_CODES={idle:0,working:1,waiting:2,finished:3},t.prototype.perform=function(){var t,e;if(this.deferred=Q.defer(),this.communicator.busy())throw new Error("Plugin is busy");return e=Array.prototype.slice.call(arguments,0),t=[this._startPluginAction(),this.device.number,this.dataType].concat(e),this.communicator.invoke.apply(this.communicator,t),this._checkFinished(this.deferred),this.deferred.promise},t.prototype._startPluginAction=function(){return"Start"+this.pluginAction},t.prototype._finishPluginAction=function(){return"Finish"+this.pluginAction},t.prototype._checkFinished=function(t){switch(this.communicator.invoke(this._finishPluginAction())){case this.STATUS_CODES.working:return this._onWorking(t);case this.STATUS_CODES.finished:return this._onFinished(t);case this.STATUS_CODES.waiting:return this._onWaiting(t);case this.STATUS_CODES.idle:return this._onIdle(t);default:throw new Error("Unexpected Velociraptor.")}},t.prototype._onWorking=function(t){var e=this;return t.notify(this._progress()),setTimeout(function(){return e._checkFinished(t)},100)},t.prototype._onWaiting=function(t){var e=this;return setTimeout(function(){return e._checkFinished(t)},150)},t.prototype._onIdle=function(t){return t.reject()},t.prototype._onFinished=function(){throw new Error("Abstract method: Not Implemented")},t.prototype._progress=function(){var t,e,i,n=this;return t={content:[],percent:0},e=this._getProgressXml().getElementsByTagName("ProgressWidget")[0],t.message=null!=(i=e.getElementsByTagName("Title")[0])?i.textContent:void 0,_.each(e.getElementsByTagName("Text"),function(e){return e.textContent.match(n.PERCENT_REGEX)?t.percent=parseInt(e.textContent,10):t.content.push(e.textContent)}),t},t.prototype._getProgressXml=function(){var t;return t=this.communicator.read("ProgressXml"),i.parse(t)},t}()}).call(this);
},{"../../src/communicator":1,"../utils/xmlparser":7}],4:[function(require,module,exports){
(function(){var t,r,e,o,i,n,c={}.hasOwnProperty,s=function(t,r){function e(){this.constructor=t}for(var o in r)c.call(r,o)&&(t[o]=r[o]);return e.prototype=r.prototype,t.prototype=new e,t.__super__=r.prototype,t};r=require("../communicator").Communicator,t=require("./accessor").Accessor,e=require("../workouts/fit_workout_factory").FitWorkoutFactory,i=require("../workouts/tcx_workout_factory").TcxWorkoutFactory,exports.Reader=o=function(t){function r(){return n=r.__super__.constructor.apply(this,arguments)}return s(r,t),r.prototype.ACTION="Read",r.prototype.perform=function(){return this.clearDeviceXmlBuffers(),r.__super__.perform.apply(this,arguments),this.deferred.promise},r.prototype.clearDeviceXmlBuffers=function(){return this.communicator.write("TcdXml",""),this.communicator.write("DirectoryListingXml","")},r.prototype._onFinished=function(t){return t.notify({percent:100}),t.resolve(this.handleFinishedReading())},r.prototype.handleFinishedReading=function(){switch(this.pluginMethod){case"FITDirectory":return this.handleReadFITDirectory();case"FitnessDirectory":return this.handleReadFitnessDirectory();case"FitnessDetail":return this.handleReadFitnessDetail()}},r.prototype.handleReadFITDirectory=function(){var t;return t=this.communicator.read("DirectoryListingXml"),new e(this.device).produce(t)},r.prototype.handleReadFitnessDirectory=function(){var t;return t=this.communicator.read("TcdXml"),new i(this.device).produce(t)},r.prototype.handleReadFitnessDetail=function(){return this.communicator.read("TcdXml")},r}(t)}).call(this);
},{"../communicator":1,"../workouts/fit_workout_factory":9,"../workouts/tcx_workout_factory":11,"./accessor":3}],5:[function(require,module,exports){
(function(){var t,o;t=require("../src/communicator").Communicator,window.Garmin=o=function(){"use strict";function o(o){null==o&&(o={}),this.configuration=_(o).defaults({unlockCodes:this.mergeUnlockCodes(o.unlockCodes),testMode:!1}),this.communicator=t.get(this.configuration),this.unlock()}return o.prototype.DEFAULT_UNLOCK_CODES={"file:///":"cb1492ae040612408d87cc53e3f7ff3c","http://localhost":"45517b532362fc3149e4211ade14c9b2","http://127.0.0.1":"40cd4860f7988c53b15b8491693de133"},o.prototype.mergeUnlockCodes=function(t){return null==t&&(t={}),_(this.DEFAULT_UNLOCK_CODES).defaults(t)},o.prototype.isInstalled=function(){return this.isInstalled=this.communicator.pluginIsInstalled||this.configuration.testMode},o.prototype.unlock=function(){return this.configuration.testMode?void 0:this.communicator.unlock(this.configuration.unlockCodes)},o.prototype.devices=function(){return this.communicator.devices()},o}()}).call(this);
},{"../src/communicator":1}],6:[function(require,module,exports){
(function(){var t;exports.Plugin=t=function(){"use strict";function t(){this.el||(this.el=this._createPluginEl())}return t.prototype.softwareVersion=function(){return this.el.getPluginVersion()},t.prototype._createPluginEl=function(){return this._smellsLikeIE()?this._createIEPlugin():this._createVanillaPlugin()},t.prototype.pluginIsInstalled=function(){return null!=this.el.Unlock?!0:!1},t.prototype._smellsLikeIE=function(){return null!=window.ActiveXObject},t.prototype._createVanillaPlugin=function(){var t,e;return e=document.createElement("div"),e.style.width=0,e.style.height=0,t=document.createElement("object"),t.id="GarminNetscapePlugin",t.height=0,t.width=0,t.setAttribute("type","application/vnd-garmin.mygarmin"),e.appendChild(t),document.body.appendChild(e),t},t.prototype._createIEPlugin=function(){var t;return t=document.createElement("object"),t.id="GarminActiveXControl",t.style.width=0,t.style.height=0,t.style.visibility="hidden",t.height=0,t.width=0,t.setAttribute("classid","CLSID:099B5A62-DE20-48C6-BF9E-290A9D1D8CB5"),document.body.appendChild(t),t},t}()}).call(this);
},{}],7:[function(require,module,exports){
(function(){var r;exports.XMLParser=r=function(){"use strict";function r(){}return r.parse=function(r){if(null==this._parser&&this._getParser(),"string"!=typeof r)throw new Error("XML is not a string!");return this._parser(r)},r._getParser=function(){return this._parser=function(){if(this._domParserAvailable())return this._domParser;if(this._xmlDomAvailable())return this._xmlDomParser;throw new Error("No XML parser found, can't parse XML")}.call(this)},r._domParserAvailable=function(){return null!=window.DOMParser},r._xmlDomAvailable=function(){return null!=window.ActiveXObject&&("function"==typeof window.ActiveXObject?window.ActiveXObject("Microsoft.XMLDOM"):void 0)},r._domParser=function(r){return(new window.DOMParser).parseFromString(r,"text/xml")},r._xmlDomParser=function(r){var t;return t=new window.ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(r)},r}()}).call(this);
},{}],8:[function(require,module,exports){
(function(){var t,i;t=require("../../src/communicator").Communicator,exports.FitWorkout=i=function(){"use strict";function i(i,e,r,o,n){this.id=e,this.device=i,this.type=r,this.date=o,this.path=n,this.communicator=t.get()}return i.prototype.getData=function(){var t;return t=Q.defer(),t.resolve(this._getBinaryFile()),t.promise},i.prototype._getBinaryFile=function(){return this.communicator.invoke("GetBinaryFile",this.device.number,this.path,!1)},i}()}).call(this);
},{"../../src/communicator":1}],9:[function(require,module,exports){
(function(){var t,e,r,o,i,n=function(t,e){return function(){return t.apply(e,arguments)}},l={}.hasOwnProperty,p=function(t,e){function r(){this.constructor=t}for(var o in e)l.call(e,o)&&(t[o]=e[o]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};o=require("../utils/xmlparser").XMLParser,r=require("./workout_factory").WorkoutFactory,t=require("./fit_workout").FitWorkout,exports.FitWorkoutFactory=e=function(e){function r(){return this._filterFitFileXmlType=n(this._filterFitFileXmlType,this),this._objectForFileNode=n(this._objectForFileNode,this),i=r.__super__.constructor.apply(this,arguments)}return p(r,e),r.prototype.produce=function(t){var e;return e=o.parse(t),_.chain(e.getElementsByTagName("File")).filter(this._filterFitFileXmlType).map(this._objectForFileNode).value()},r.prototype._objectForFileNode=function(e){var r,o,i,n;return o=this._getIdForFileNode(e),n=this._getFileTypeForFileNode(e),r=this._getCreationTimeFileNode(e),i=this._getPathForFileNode(e),new t(this.device,o,n,r,i)},r.prototype._getCreationTimeFileNode=function(t){var e;return e=t.getElementsByTagName("CreationTime")[0].textContent,this._parseISODateString(e)},r.prototype._filterFitFileXmlType=function(t){return this._getFileTypeForFileNode(t)===this.FITFILE_TYPES.activities},r.prototype._getIdForFileNode=function(t){return parseInt(t.getElementsByTagName("FitId")[0].getElementsByTagName("Id")[0].textContent,10)},r.prototype._getFileTypeForFileNode=function(t){return parseInt(t.getElementsByTagName("FitId")[0].getElementsByTagName("FileType")[0].textContent,10)},r.prototype._getPathForFileNode=function(t){return t.getAttribute("Path")},r}(r)}).call(this);
},{"../utils/xmlparser":7,"./fit_workout":8,"./workout_factory":12}],10:[function(require,module,exports){
(function(){var e;exports.TcxWorkout=e=function(){"use strict";function e(e,t,i){var r;r=require("../device/reader").Reader,this.device=e,this.id=t,this.date=i,this.detailReader=new r(this.device,"FitnessHistory","FitnessDetail")}return e.prototype.getData=function(){return this.detailReader.perform(this.id)},e}()}).call(this);
},{"../device/reader":4}],11:[function(require,module,exports){
(function(){var t,r,e,o,i,n=function(t,r){return function(){return t.apply(r,arguments)}},a={}.hasOwnProperty,c=function(t,r){function e(){this.constructor=t}for(var o in r)a.call(r,o)&&(t[o]=r[o]);return e.prototype=r.prototype,t.prototype=new e,t.__super__=r.prototype,t};o=require("../utils/xmlparser").XMLParser,e=require("./workout_factory").WorkoutFactory,t=require("./tcx_workout").TcxWorkout,exports.TcxWorkoutFactory=r=function(r){function e(){return this._getIdForActivityNode=n(this._getIdForActivityNode,this),this._getFirstLapStartTime=n(this._getFirstLapStartTime,this),this._objectForActivityNode=n(this._objectForActivityNode,this),i=e.__super__.constructor.apply(this,arguments)}return c(e,r),e.prototype.produce=function(t){var r;return r=o.parse(t),_.chain(r.getElementsByTagName("Activity")).map(this._objectForActivityNode).value()},e.prototype._objectForActivityNode=function(r){var e,o;return o=this._getIdForActivityNode(r),e=this._getFirstLapStartTime(r),new t(this.device,o,e)},e.prototype._getFirstLapStartTime=function(t){var r;return r=t.getElementsByTagName("Lap")[0].getAttribute("StartTime"),this._parseISODateString(r)},e.prototype._getIdForActivityNode=function(t){return t.getElementsByTagName("Id")[0].textContent},e}(e)}).call(this);
},{"../utils/xmlparser":7,"./tcx_workout":10,"./workout_factory":12}],12:[function(require,module,exports){
(function(){var E;exports.WorkoutFactory=E=function(){"use strict";function E(E){this.device=E}return E.prototype.FITFILE_TYPES={activities:4,goals:11,locations:8,monitoring:9,profiles:2,schedules:7,sports:3,totals:10},E.prototype._parseISODateString=function(E){var t;return this.REPLACE_DATE_DASHES_REGEX||(this.REPLACE_DATE_DASHES_REGEX=/-/g),this.REPLACE_DATE_TZ_REGEX||(this.REPLACE_DATE_TZ_REGEX=/[TZ]/g),t=E.replace(this.REPLACE_DATE_DASHES_REGEX,"/").replace(this.REPLACE_DATE_TZ_REGEX," "),new Date(t)},E}()}).call(this);
},{}]},{},[5])
;